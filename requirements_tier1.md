# Nogue Requirements — Tier 1 (MVP)

この文書は `requirements.md` の全体仕様から、Tier1（単圃場・基礎タグ）に該当する最低限スコープを抽出し、MVP観点で「必須 / 後回し（Nice-to-have）」を明確化したものです。曖昧だった数値・条件は暫定値に固定しています（将来調整可）。

最終更新: 2025-09-14

---

## 1. ゴールとプレイ範囲

- スコープ: 単一 Patch（圃場）での1日サイクル運用と、少数の単発契約の達成。
- 目的: 「今日のK件」提示→行為選択→夜間解決→勝敗判定の一連の体験を、最小機能で成立させる。

---

## 2. MVP スコープ（必須 / 後回し）

- 必須（Must）
  - ゲームループ（朝→昼→夜→勝敗判定→翌日）
  - データ構造（WorldState: 資金/日付/AP/勝敗/RNGシード、PatchState: Tags/Devices 空）
  - タグ最小集合（requirements.md 1.1 の環境/状態を採用、離散値は整数、連続量はQ16.16）
  - 行為（Actions）最小セット: 耕す/播種/灌水/収穫
  - イベント提示（K=難易度依存、標準3）と選抜（solvableNow 準拠・簡易版）
  - 契約（単発小口、品質C以上、期限あり、達成報酬）
  - 余波（Cascade）内部計算: 最大深さ5、UIは上位3のみ表示
  - 勝敗判定（契約達成で勝利／資金ショック・病原圧暴走で敗北）
  - 再現性（xoshiro128++／Run→Day→Event 階層Seed）
  - 最小UI（HUD: 日付・資金・AP、イベント候補K件、行為実行ログ、タグ変化の簡易可視化）

- 後回し（Later / Nice-to-have for Tier1 以降で拡張）
  - 追加行為: 除草/マルチ/火入れ/出荷/修理 等（Tier2+で段階導入）
  - 用水・風・生態の橋エッジ（次数制限）はTier2以降で導入
  - 自動化デバイス（スプリンクラー等）
  - 品質係数と価格の逓増（T4以降）
  - 生態網・交配（T5/T6）

---

## 3. 固定パラメータ（Tier1 既定値）

- AP: `AP_base=10`/日、`AP_min=1`（requirements.md 0.1/1.6 に準拠）
- イベント提示K: 難易度で固定（易2 / 標準3 / 難4）
- 余波深さ: 内部5、可視3（上位のみ）
- PRNG: xoshiro128++、固定小数点Q16.16 を使用

---

## 4. 行為（Tier1 最小セット）

| 行為 | AP | 資金 | 効果（概要） | 前提 |
|---|---:|---:|---|---|
| 耕す | 2 | 0 | 土壌の初期化（肥沃度・pH微調整、被覆リセット） | 1日1回 / Patch |
| 播種 | 1 | 0 | 作物をパッチに設定（麦/豆/葉菜のいずれか） | 耕し後 / 種子在庫OK |
| 灌水 | 1 | 0 | 湿度+1（r=1） | 連続2回まで/日 |
| 収穫 | 3 | 0 | 収量算出→在庫/契約進捗へ計上 | 成熟期 |

注: 出荷はTier1では夜間自動処理（契約達成計上の一部）とし、専用アクションは後回し。

---

## 5. 契約（Tier1 最小）

- 種別: 単発小口（数量少、品質C以上）
- 期限: 3〜5日（難易度で変動: 易5/標準4/難3）
- 達成判定: 夜間に収穫在庫から自動充当し、数量・品質を満たせば達成
- 報酬: 固定額（品質による逓増は未導入）

---

## 6. 勝敗条件（機械可読の骨子）

- 勝利: 期間内に「契約達成数 ≥ 2」かつ最終日資金≥0
- 敗北:
  - 資金ショック: 資金<0が連続3日（グレース2日）。初日は緊急融資イベントを発火（警告のみ、数値効果は未実装でも可）
  - 疫病暴走: 病原圧=5が連続3日（当日夜に警告→3日目終了時に敗北）

擬似コードは `docs/Design/VictoryLoss_Tier1.md` に詳細化。

---

## 7. イベント提示（K件）

- 候補収集: 病兆/受粉チャンス/小雨/相場波/契約期限接近 等
- スコア: `danger × solvable × novelty × diversity × contractBoost`
- solvableNow（簡易版）: `AP/資金/解禁の即応性` と `期限猶予` の閾値で判定
- ε注入: 低確率で未体験タイプを1枠差し替え（εは0.05固定・暫定）

---

## 8. 曖昧な数値・条件の暫定確定

requirements.md における曖昧表現をTier1向けに以下で固定します。

- 「資金<0はグレース2日」 vs 「資金<0が2日連続で敗北」の不一致 → 連続3日で敗北に統一（グレース2日）。
- 「病原圧5が一定日数継続」 → 連続3日で敗北。
- 「事故率（stabilityの逆数）」の定義 → 直近7日間で発生した“事故”の頻度。事故=「当日収量損失≥20%」または「病原圧≥4到達」のいずれか。`accident_rate = count/7`。
- `solvableNow` の閾値 → 深さ2の貪欲探索成功確率≥0.7（requirements.md 4.2準拠）。期限のある契約候補は、今日+翌日以内の手数見込みが期限内であること。
- Kの既定 → 標準難度で3（易2/難4）。ラン中は固定。
- 夜間の自動出荷 → Tier1は収穫在庫から契約へ自動充当。未充当分は在庫保持のみ（市場即売は未実装）。

---

## 9. UI 最小要件

- メインHUD: 日付・資金・APを表示
- イベントパネル: 今日の候補K件（スコア順）/簡易根拠（ピクト）
- 行為UI: ボタン+対象選択、コスト/結果ログのテキスト表示
- タグ可視化: Patchの主要タグ（湿度/病原圧/肥沃度）を簡易バーで表示
- 余波ログ: 上位3件のみ表示

---

## 10. データとツール連携

- コンテンツ: `content/tiers/T1.yaml` の値に整合（K/解禁など）。
- バリデーション: `tools/DataValidator/validate.py` を用い、ID/参照整合を担保。
- エクスポート: `tools/ContentTools/export_tiers_json.py` / `export_content_json.py`（CI/ローカル）

---

## 11. 非スコープ（Tier1では扱わない）

- 風/水/生態ブリッジ、装置の劣化/故障、品質係数に基づく価格逓増、定期契約、複数Patch、交配/系統固定。

---

## 12. 変更履歴（抜粋）

- 2025-09-14: 初版作成。資金ショック/病原圧の閾値、事故率の定義、夜間自動出荷の扱いを暫定確定。

